<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="raisetech.student.management.repository.StudentRepository">

  <!-- 受講生の全件検索 -->
  <select id="searchStudent" resultType="raisetech.student.management.data.Student">
    SELECT * FROM students
  </select>

  <!-- 受講生単一検索 -->
  <select id="searchStudentById" resultType="raisetech.student.management.data.Student">
    SELECT * FROM students WHERE student_id = #{studentId}
  </select>

  <!-- コース情報一覧検索 -->
  <select id="searchCourse" resultType="raisetech.student.management.data.Course">
    SELECT * FROM courses
  </select>

  <!-- コース情報検索 -->
  <select id="searchCoursesById" resultType="raisetech.student.management.data.Course">
    SELECT * FROM courses WHERE course_id IN
    <foreach item="id" collection="courseIds" open="(" separator="," close=")">
      #{id}
    </foreach>
  </select>

  <!-- 受講コース情報一覧検索 -->
  <select id="searchStudentsCourses" resultType="raisetech.student.management.data.StudentCourse">
    SELECT * FROM students_courses
  </select>

  <!-- 受講コース情報検索 -->
  <select id="searchStudentsCoursesById"
    resultType="raisetech.student.management.data.StudentCourse">
    SELECT * FROM students_courses WHERE student_id = #{studentId}
  </select>

  <!-- 新規受講生登録 -->
  <insert id="registerStudent" parameterType="raisetech.student.management.data.Student"
    useGeneratedKeys="true" keyProperty="studentId">
    INSERT INTO students(name,furigana,nickname,mail_address,address,age,gender,remark,isDeleted)
    VALUES(#{name},#{furigana},#{nickname},#{mailAddress},#{address},#{age},#{gender},#{remark},false)
  </insert>

  <!-- 新規受講コース登録 -->
  <insert id="registerCourse" parameterType="raisetech.student.management.data.StudentCourse">
    INSERT INTO students_courses(student_ID,course_ID,start_date,end_date)
    VALUES(#{studentId},#{courseId},#{startDate},#{endDate})
  </insert>

  <!-- 受講コース情報削除 -->
  <delete id="deleteStudentCourse">
    DELETE FROM students_courses WHERE student_id = #{studentId} AND course_id = #{courseId}
  </delete>

  <!-- 受講生情報更新（名前） -->
  <update id="updateStudentName">
    UPDATE students SET name = #{value} WHERE student_id = #{studentId}
  </update>

  <!-- 受講生情報更新（フリガナ） -->
  <update id="updateStudentFurigana">
    UPDATE students SET furigana = #{value} WHERE student_id = #{studentId}
  </update>

  <!-- 受講生情報更新（ニックネーム） -->
  <update id="updateStudentNickname">
    UPDATE students SET nickname = #{value} WHERE student_id = #{studentId}
  </update>

  <!-- 受講生情報更新（メールアドレス） -->
  <update id="updateStudentMailAddress">
    UPDATE students SET mailAddress = #{value} WHERE student_id = #{studentId}
  </update>

  <!-- 受講生情報更新（住所） -->
  <update id="updateStudentAddress">
    UPDATE students SET Address = #{value} WHERE student_id = #{studentId}
  </update>

  <!-- 受講生情報更新（年齢） -->
  <update id="updateStudentAge">
    UPDATE students SET age = #{value} WHERE student_id = #{studentId}
  </update>

  <!-- 受講生情報更新（性別） -->
  <update id="updateStudentGender">
    UPDATE students SET gender = #{value} WHERE student_id = #{studentId}
  </update>

  <!-- 受講生情報更新（備考） -->
  <update id="updateStudentRemark">
    UPDATE students SET remark = #{value} WHERE student_id = #{studentId}
  </update>

  <!-- 受講生情報論理削除 -->
  <update id="logicalDeleteStudent">
    UPDATE students SET isDeleted = #{isDeleted} WHERE student_id = #{studentId}
  </update>


</mapper>
